<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.2 Filtering | patRoon handbook</title>
  <meta name="description" content="5.2 Filtering | patRoon handbook" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="5.2 Filtering | patRoon handbook" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.2 Filtering | patRoon handbook" />
  
  
  

<meta name="author" content="Rick Helmus" />


<meta name="date" content="2019-10-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="inspecting-results.html"/>
<link rel="next" href="subset.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.1/grViz.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/d3-3.5.3/./d3.min.js"></script>
<link href="libs/d3heatmapcore-0.0.0/heatmapcore.css" rel="stylesheet" />
<script src="libs/d3heatmapcore-0.0.0/heatmapcore.js"></script>
<script src="libs/d3-tip-0.6.6/index.js"></script>
<script src="libs/d3heatmap-binding-0.6.1.2/d3heatmap.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a><ul>
<li class="chapter" data-level="2.1" data-path="automatic-installation-windows-only.html"><a href="automatic-installation-windows-only.html"><i class="fa fa-check"></i><b>2.1</b> Automatic installation (Windows only)</a></li>
<li class="chapter" data-level="2.2" data-path="manual-installation.html"><a href="manual-installation.html"><i class="fa fa-check"></i><b>2.2</b> Manual installation</a><ul>
<li class="chapter" data-level="2.2.1" data-path="manual-installation.html"><a href="manual-installation.html#r-prerequisites"><i class="fa fa-check"></i><b>2.2.1</b> R prerequisites</a></li>
<li class="chapter" data-level="2.2.2" data-path="manual-installation.html"><a href="manual-installation.html#other-dependencies"><i class="fa fa-check"></i><b>2.2.2</b> Other dependencies</a></li>
<li class="chapter" data-level="2.2.3" data-path="manual-installation.html"><a href="manual-installation.html#patroon-installation"><i class="fa fa-check"></i><b>2.2.3</b> patRoon installation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow-concepts.html"><a href="workflow-concepts.html"><i class="fa fa-check"></i><b>3</b> Workflow concepts</a></li>
<li class="chapter" data-level="4" data-path="generating-workflow-data.html"><a href="generating-workflow-data.html"><i class="fa fa-check"></i><b>4</b> Generating workflow data</a><ul>
<li class="chapter" data-level="4.1" data-path="preparations.html"><a href="preparations.html"><i class="fa fa-check"></i><b>4.1</b> Preparations</a><ul>
<li class="chapter" data-level="4.1.1" data-path="preparations.html"><a href="preparations.html#data-pre-treatment"><i class="fa fa-check"></i><b>4.1.1</b> Data pre-treatment</a></li>
<li class="chapter" data-level="4.1.2" data-path="preparations.html"><a href="preparations.html#anaInfo"><i class="fa fa-check"></i><b>4.1.2</b> Analysis information</a></li>
<li class="chapter" data-level="4.1.3" data-path="preparations.html"><a href="preparations.html#automatic-project-generation-with-newproject"><i class="fa fa-check"></i><b>4.1.3</b> Automatic project generation with newProject()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>4.2</b> Features</a><ul>
<li class="chapter" data-level="4.2.1" data-path="features.html"><a href="features.html#finding-and-grouping-features"><i class="fa fa-check"></i><b>4.2.1</b> Finding and grouping features</a></li>
<li class="chapter" data-level="4.2.2" data-path="features.html"><a href="features.html#suspect-screening"><i class="fa fa-check"></i><b>4.2.2</b> Suspect screening</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="annotation.html"><a href="annotation.html"><i class="fa fa-check"></i><b>4.3</b> Annotation</a><ul>
<li class="chapter" data-level="4.3.1" data-path="annotation.html"><a href="annotation.html#ms-peak-lists"><i class="fa fa-check"></i><b>4.3.1</b> MS peak lists</a></li>
<li class="chapter" data-level="4.3.2" data-path="annotation.html"><a href="annotation.html#formulae"><i class="fa fa-check"></i><b>4.3.2</b> Formulae</a></li>
<li class="chapter" data-level="4.3.3" data-path="annotation.html"><a href="annotation.html#compounds"><i class="fa fa-check"></i><b>4.3.3</b> Compounds</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="componentization.html"><a href="componentization.html"><i class="fa fa-check"></i><b>4.4</b> Componentization</a><ul>
<li class="chapter" data-level="4.4.1" data-path="componentization.html"><a href="componentization.html#features-with-similar-chromatographic-behaviour"><i class="fa fa-check"></i><b>4.4.1</b> Features with similar chromatographic behaviour</a></li>
<li class="chapter" data-level="4.4.2" data-path="componentization.html"><a href="componentization.html#homologues-series"><i class="fa fa-check"></i><b>4.4.2</b> Homologues series</a></li>
<li class="chapter" data-level="4.4.3" data-path="componentization.html"><a href="componentization.html#intclust"><i class="fa fa-check"></i><b>4.4.3</b> Intensity clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="processing-workflow-data.html"><a href="processing-workflow-data.html"><i class="fa fa-check"></i><b>5</b> Processing workflow data</a><ul>
<li class="chapter" data-level="5.1" data-path="inspecting-results.html"><a href="inspecting-results.html"><i class="fa fa-check"></i><b>5.1</b> Inspecting results</a></li>
<li class="chapter" data-level="5.2" data-path="filtering.html"><a href="filtering.html"><i class="fa fa-check"></i><b>5.2</b> Filtering</a><ul>
<li class="chapter" data-level="5.2.1" data-path="filtering.html"><a href="filtering.html#features-1"><i class="fa fa-check"></i><b>5.2.1</b> Features</a></li>
<li class="chapter" data-level="5.2.2" data-path="filtering.html"><a href="filtering.html#annotation-1"><i class="fa fa-check"></i><b>5.2.2</b> Annotation</a></li>
<li class="chapter" data-level="5.2.3" data-path="filtering.html"><a href="filtering.html#components"><i class="fa fa-check"></i><b>5.2.3</b> Components</a></li>
<li class="chapter" data-level="5.2.4" data-path="filtering.html"><a href="filtering.html#negation"><i class="fa fa-check"></i><b>5.2.4</b> Negation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="subset.html"><a href="subset.html"><i class="fa fa-check"></i><b>5.3</b> Subsetting</a><ul>
<li class="chapter" data-level="5.3.1" data-path="subset.html"><a href="subset.html#prioritization-workflow"><i class="fa fa-check"></i><b>5.3.1</b> Prioritization workflow</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="unOv.html"><a href="unOv.html"><i class="fa fa-check"></i><b>5.4</b> Unique and overlapping features</a></li>
<li class="chapter" data-level="5.5" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5.5</b> Visualization</a><ul>
<li class="chapter" data-level="5.5.1" data-path="visualization.html"><a href="visualization.html#features-and-annatation-data"><i class="fa fa-check"></i><b>5.5.1</b> Features and annatation data</a></li>
<li class="chapter" data-level="5.5.2" data-path="visualization.html"><a href="visualization.html#visComp"><i class="fa fa-check"></i><b>5.5.2</b> Comparing data</a></li>
<li class="chapter" data-level="5.5.3" data-path="visualization.html"><a href="visualization.html#plotClust"><i class="fa fa-check"></i><b>5.5.3</b> Hierarchical clustering results</a></li>
<li class="chapter" data-level="5.5.4" data-path="visualization.html"><a href="visualization.html#interactive-plotting-of-chromatography-data"><i class="fa fa-check"></i><b>5.5.4</b> Interactive plotting of chromatography data</a></li>
<li class="chapter" data-level="5.5.5" data-path="visualization.html"><a href="visualization.html#generating-eics-in-dataanalysis"><i class="fa fa-check"></i><b>5.5.5</b> Generating EICs in DataAnalysis</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>5.6</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="advanced-usage.html"><a href="advanced-usage.html"><i class="fa fa-check"></i><b>6</b> Advanced usage</a><ul>
<li class="chapter" data-level="6.1" data-path="adducts.html"><a href="adducts.html"><i class="fa fa-check"></i><b>6.1</b> Adducts</a></li>
<li class="chapter" data-level="6.2" data-path="fOpt.html"><a href="fOpt.html"><i class="fa fa-check"></i><b>6.2</b> Feature parameter optimization</a><ul>
<li class="chapter" data-level="6.2.1" data-path="fOpt.html"><a href="fOpt.html#parameter-sets"><i class="fa fa-check"></i><b>6.2.1</b> Parameter sets</a></li>
<li class="chapter" data-level="6.2.2" data-path="fOpt.html"><a href="fOpt.html#processing-optmization-results"><i class="fa fa-check"></i><b>6.2.2</b> Processing optmization results</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="exporting-and-converting-feature-data.html"><a href="exporting-and-converting-feature-data.html"><i class="fa fa-check"></i><b>6.3</b> Exporting and converting feature data</a></li>
<li class="chapter" data-level="6.4" data-path="consensus.html"><a href="consensus.html"><i class="fa fa-check"></i><b>6.4</b> Algorithm consensus</a></li>
<li class="chapter" data-level="6.5" data-path="compclust.html"><a href="compclust.html"><i class="fa fa-check"></i><b>6.5</b> Compound clustering</a></li>
<li class="chapter" data-level="6.6" data-path="caching.html"><a href="caching.html"><i class="fa fa-check"></i><b>6.6</b> Caching</a></li>
<li class="chapter" data-level="6.7" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>6.7</b> Parallelization</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">patRoon handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="filtering" class="section level2">
<h2><span class="header-section-number">5.2</span> Filtering</h2>
<p>During a non-target workflow it is not uncommon that some kind of data-cleanup is necessary. Datasets are often highly complex, which makes separating data of interest from the rest highly important. Furthermore, general cleanup typically improves the quality of the dataset, for instance by removing low scoring annotation results or features that are unlikely to be ‘correct’ (e.g. noise or present in blanks). For this reason <code>patRoon</code> supports <em>many</em> different filters that easily clean data produced during the workflow in a highly customizable way.</p>
<p>All major workflow objects (e.g. <code>featureGroups</code>, <code>compounds</code>, <code>components</code> etc.) support filtering operations by the <code>filter()</code> generic. This function takes the object to be filtered as first argument and any remaining arguments describe the desired filter options. The <code>filter()</code> generic function then returns the modified object back. Some examples are shown below.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="co"># remove low intensity (&lt;500) features</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2">features &lt;-<span class="st"> </span><span class="kw">filter</span>(features, <span class="dt">absMinIntensity =</span> <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb54-3" data-line-number="3"></a>
<a class="sourceLine" id="cb54-4" data-line-number="4"><span class="co"># remove features with intensities lower than 5 times the blank</span></a>
<a class="sourceLine" id="cb54-5" data-line-number="5">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(fGroups, <span class="dt">blankThreshold =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb54-6" data-line-number="6"></a>
<a class="sourceLine" id="cb54-7" data-line-number="7"><span class="co"># only retain compounds with &gt;1 explained MS/MS peaks</span></a>
<a class="sourceLine" id="cb54-8" data-line-number="8">compounds &lt;-<span class="st"> </span><span class="kw">filter</span>(compounds, <span class="dt">minExplainedPeaks =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>The following sections will provide a more detailed overview of available data filters.</p>
<div id="features-1" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Features</h3>
<p>There are many filters available for feature data:</p>
<table>
<colgroup>
<col width="33%" />
<col width="21%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th>Filter</th>
<th>Classes</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>absMinIntensity</code>, <code>relMinIntensity</code></td>
<td><code>features</code>, <code>featureGroups</code></td>
<td>Minimum intensity</td>
</tr>
<tr class="even">
<td><code>preAbsMinIntensity</code>, <code>preRelMinIntensity</code></td>
<td><code>featureGroups</code></td>
<td>Minimum intensity prior to other filtering (see below)</td>
</tr>
<tr class="odd">
<td><code>retentionRange</code>, <code>mzRange</code>, <code>mzDefectRange</code>, <code>chromWidthRange</code></td>
<td><code>features</code>, <code>featureGroups</code></td>
<td>Filter by feature properties</td>
</tr>
<tr class="even">
<td><code>absMinAnalyses</code>, <code>relMinAnalyses</code></td>
<td><code>featureGroups</code></td>
<td>Minimum feature abundance in all analyses</td>
</tr>
<tr class="odd">
<td><code>absMinReplicates</code>, <code>relMinReplicates</code></td>
<td><code>featureGroups</code></td>
<td>Minimum feature abundance in different replicates</td>
</tr>
<tr class="even">
<td><code>absMinFeatures</code>, <code>relMinFeatures</code></td>
<td><code>featureGroups</code></td>
<td>Only keep analyses with at least this amount of features</td>
</tr>
<tr class="odd">
<td><code>absMinReplicateAbundance</code>, <code>relMinReplicateAbundance</code></td>
<td><code>featureGroups</code></td>
<td>Minimum feature abundance in a replicate group</td>
</tr>
<tr class="even">
<td><code>maxReplicateIntRSD</code></td>
<td><code>featureGroups</code></td>
<td>Maximum relative standard deviation of feature intensities in a replicate group.</td>
</tr>
<tr class="odd">
<td><code>blankThreshold</code></td>
<td><code>featureGroups</code></td>
<td>Minimum intensity factor above blank intensity</td>
</tr>
<tr class="even">
<td><code>rGroups</code></td>
<td><code>featureGroups</code></td>
<td>Only keep (features of) these replicate groups</td>
</tr>
</tbody>
</table>
<p>Application of filters to feature data is important for (environmental) non-target analysis. Especially blank and replicate filters (i.e. <code>blankThreshold</code> and <code>absMinReplicateAbundance</code>/<code>relMinReplicateAbundance</code>) are important filters and are highly recommended to always apply for cleaning up your dataset.</p>
<p>All filters are available for feature group data, whereas only a subset is available for feature objects. The main reason is that other filters need grouping of features between analyses. Regardless, in <code>patRoon</code> filtering feature data is less important, and typically only needed when the number of features are extremely large and direct grouping is undesired.</p>
<p>From the table above you can notice that many filters concern both <em>absolute</em> and <em>relative</em> data (i.e. as prefixed with <code>abs</code> and <code>rel</code>). When a relative filter is used the value is scaled between <em>0</em> and <em>1</em>. For instance:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="co"># remove features not present in at least half of the analyses within a replicate group</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(fGroups, <span class="dt">relMinReplicateAbundance =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p>An advantage of relative filters is that you will not have to worry about the data size involved. For instance, in the above example the filter always takes half of the number of analyses within a replicate group, even when replicate groups have different number of analyses.</p>
<p>Note that multiple filters can be specified at once. Especially for feature group data the order of filtering may impact the final results, this is explained further in the reference manual (i.e. <code>?`feature-filtering`</code>).</p>
<p>Some examples are shown below.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="co"># filter features prior to grouping: remove any features eluting before first 2 minutes</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2">fList &lt;-<span class="st"> </span><span class="kw">filter</span>(fList, <span class="dt">retentionRange =</span> <span class="kw">c</span>(<span class="dv">120</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb56-3" data-line-number="3"></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="co"># common filters for feature groups</span></a>
<a class="sourceLine" id="cb56-5" data-line-number="5">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(fGroups,</a>
<a class="sourceLine" id="cb56-6" data-line-number="6">                  <span class="dt">absMinIntensity =</span> <span class="dv">500</span>, <span class="co"># remove features &lt;500 intensity</span></a>
<a class="sourceLine" id="cb56-7" data-line-number="7">                  <span class="dt">relMinReplicateAbundance =</span> <span class="dv">1</span>, <span class="co"># features should be in all analysis of replicate groups</span></a>
<a class="sourceLine" id="cb56-8" data-line-number="8">                  <span class="dt">maxReplicateIntRSD =</span> <span class="fl">0.75</span>, <span class="co"># remove features with intensity RSD in replicates &gt;75%</span></a>
<a class="sourceLine" id="cb56-9" data-line-number="9">                  <span class="dt">blankThreshold =</span> <span class="dv">5</span>, <span class="co"># remove features &lt;5x intensity of (average) blank intensity</span></a>
<a class="sourceLine" id="cb56-10" data-line-number="10">                  <span class="dt">removeBlanks =</span> <span class="ot">TRUE</span>) <span class="co"># remove blank analyses from object afterwards</span></a>
<a class="sourceLine" id="cb56-11" data-line-number="11"></a>
<a class="sourceLine" id="cb56-12" data-line-number="12"><span class="co"># filter by feature properties</span></a>
<a class="sourceLine" id="cb56-13" data-line-number="13">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(<span class="dt">mzDefectRange =</span> <span class="kw">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>),</a>
<a class="sourceLine" id="cb56-14" data-line-number="14">                  <span class="dt">chromWidthRange =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">120</span>))</a>
<a class="sourceLine" id="cb56-15" data-line-number="15"></a>
<a class="sourceLine" id="cb56-16" data-line-number="16"><span class="co"># remove features not present in at least 3 analyses</span></a>
<a class="sourceLine" id="cb56-17" data-line-number="17">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(fGroups, <span class="dt">absMinAnalyses =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb56-18" data-line-number="18"></a>
<a class="sourceLine" id="cb56-19" data-line-number="19"><span class="co"># remove features not present in at least 20% of all replicate groups</span></a>
<a class="sourceLine" id="cb56-20" data-line-number="20">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(fGroups, <span class="dt">relMinReplicates =</span> <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb56-21" data-line-number="21"></a>
<a class="sourceLine" id="cb56-22" data-line-number="22"><span class="co"># only keep data present in replicate groups &quot;repl1&quot; and &quot;repl2&quot;</span></a>
<a class="sourceLine" id="cb56-23" data-line-number="23"><span class="co"># all other features and analyses will be removed</span></a>
<a class="sourceLine" id="cb56-24" data-line-number="24">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(fGroups, <span class="dt">rGroups =</span> <span class="kw">c</span>(<span class="st">&quot;repl1&quot;</span>, <span class="st">&quot;repl2&quot;</span>))</a></code></pre></div>
</div>
<div id="annotation-1" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Annotation</h3>
<p>There are various filters available for handling annotation data:</p>
<table>
<colgroup>
<col width="36%" />
<col width="24%" />
<col width="39%" />
</colgroup>
<thead>
<tr class="header">
<th>Filter</th>
<th>Classes</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>absMSIntThr</code>, <code>absMSMSIntThr</code>, <code>relMSIntThr</code>, <code>relMSMSIntThr</code></td>
<td><code>MSPeakLists</code></td>
<td>Minimum intensity of mass peaks</td>
</tr>
<tr class="even">
<td><code>topMSPeaks</code>, <code>topMSMSPeaks</code></td>
<td><code>MSPeakLists</code></td>
<td>Only keep most intense mass peaks</td>
</tr>
<tr class="odd">
<td><code>withMSMS</code></td>
<td><code>MSPeakLists</code></td>
<td>Only keep results with MS/MS data</td>
</tr>
<tr class="even">
<td><code>minExplainedPeaks</code></td>
<td><code>formulas</code> / <code>compounds</code></td>
<td>Minimum number of annotated mass peaks</td>
</tr>
<tr class="odd">
<td><code>elements</code>, <code>fragElements</code>, <code>lossElements</code></td>
<td><code>formulas</code>, <code>compounds</code></td>
<td>Restrain elemental composition</td>
</tr>
<tr class="even">
<td><code>topMost</code></td>
<td><code>formulas</code>, <code>compounds</code></td>
<td>Only keep highest ranked candidates</td>
</tr>
<tr class="odd">
<td><code>minScore</code>, <code>minFragScore</code>, <code>minFormulaScore</code></td>
<td><code>compounds</code></td>
<td>Minimum compound scorings</td>
</tr>
<tr class="even">
<td><code>scoreLimits</code></td>
<td><code>formulas</code>, <code>compounds</code></td>
<td>Minimum/Maximum scorings</td>
</tr>
<tr class="odd">
<td><code>OM</code></td>
<td><code>formulas</code></td>
<td>Only keep candidates with likely elemental composition found in organic matter</td>
</tr>
</tbody>
</table>
<p>Several intensity related filters are available to clean-up MS peak list data. For instance, the <code>topMSPeaks</code>/<code>topMSMSPeaks</code> filters provide a simple way to remove noisy data by only retaining a defined number of most intense mass peaks. Note that none of these filters will remove the mass peak of the feature from its MS peak list.</p>
<p>The filters applicable to formula and compound annotation generally concern minimal scoring or chemical properties. The former is useful to remove unlikely candidates, whereas the second is useful to focus on certain study specific chemical properties (e.g. known neutral losses).</p>
<p>Common examples are shown below.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="co"># intensity filtering</span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2">mslists &lt;-<span class="st"> </span><span class="kw">filter</span>(mslists,</a>
<a class="sourceLine" id="cb57-3" data-line-number="3">                  <span class="dt">absMSIntThr =</span> <span class="dv">500</span>, <span class="co"># minimum MS mass peak intensity of 500</span></a>
<a class="sourceLine" id="cb57-4" data-line-number="4">                  <span class="dt">relMSMSIntThr =</span> <span class="fl">0.1</span>) <span class="co"># minimum MS/MS mass peak intensity of 10%</span></a>
<a class="sourceLine" id="cb57-5" data-line-number="5"></a>
<a class="sourceLine" id="cb57-6" data-line-number="6"><span class="co"># only retain 10 most intens mass peaks</span></a>
<a class="sourceLine" id="cb57-7" data-line-number="7"><span class="co"># (feature mass is always retained)</span></a>
<a class="sourceLine" id="cb57-8" data-line-number="8">mslists &lt;-<span class="st"> </span><span class="kw">filter</span>(mslists, <span class="dt">topMSPeaks =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb57-9" data-line-number="9"></a>
<a class="sourceLine" id="cb57-10" data-line-number="10"><span class="co"># only keep formulae with 1-10 sulphur or phosphorus elements</span></a>
<a class="sourceLine" id="cb57-11" data-line-number="11">formulas &lt;-<span class="st"> </span><span class="kw">filter</span>(formulas, <span class="dt">elements =</span> <span class="kw">c</span>(<span class="st">&quot;S1-10&quot;</span>, <span class="st">&quot;P1-10&quot;</span>))</a>
<a class="sourceLine" id="cb57-12" data-line-number="12"></a>
<a class="sourceLine" id="cb57-13" data-line-number="13"><span class="co"># only keep candidates with MS/MS fragments that contain 1-10 carbons and 0-2 oxygens</span></a>
<a class="sourceLine" id="cb57-14" data-line-number="14">formulas &lt;-<span class="st"> </span><span class="kw">filter</span>(formulas, <span class="dt">fragElements =</span> <span class="st">&quot;C1-10O0-2&quot;</span>)</a>
<a class="sourceLine" id="cb57-15" data-line-number="15"></a>
<a class="sourceLine" id="cb57-16" data-line-number="16"><span class="co"># only keep candidates with CO2 neutral loss</span></a>
<a class="sourceLine" id="cb57-17" data-line-number="17">formulas &lt;-<span class="st"> </span><span class="kw">filter</span>(formulas, <span class="dt">lossElements =</span> <span class="st">&quot;CO2&quot;</span>)</a>
<a class="sourceLine" id="cb57-18" data-line-number="18"></a>
<a class="sourceLine" id="cb57-19" data-line-number="19"><span class="co"># only keep the 15 highest ranked candidates with at least 1 annotated MS/MS peak</span></a>
<a class="sourceLine" id="cb57-20" data-line-number="20">compounds &lt;-<span class="st"> </span><span class="kw">filter</span>(compounds, <span class="dt">minExplainedPeaks =</span> <span class="dv">1</span>, <span class="dt">topMost =</span> <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb57-21" data-line-number="21"></a>
<a class="sourceLine" id="cb57-22" data-line-number="22"><span class="co"># minimum in-silico score</span></a>
<a class="sourceLine" id="cb57-23" data-line-number="23">compounds &lt;-<span class="st"> </span><span class="kw">filter</span>(compounds, <span class="dt">minFragScore =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb57-24" data-line-number="24"></a>
<a class="sourceLine" id="cb57-25" data-line-number="25"><span class="co"># candidate should be referenced in at least 1 patent</span></a>
<a class="sourceLine" id="cb57-26" data-line-number="26"><span class="co"># (only works if database lists number of patents, e.g. PubChem)</span></a>
<a class="sourceLine" id="cb57-27" data-line-number="27">compounds &lt;-<span class="st"> </span><span class="kw">filter</span>(compounds,</a>
<a class="sourceLine" id="cb57-28" data-line-number="28">                    <span class="dt">scoreLimits =</span> <span class="kw">list</span>(<span class="dt">numberPatents =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">Inf</span>))</a></code></pre></div>
</div>
<div id="components" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Components</h3>
<p>Finally several filters are available for components:</p>
<table>
<thead>
<tr class="header">
<th>Filter</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>size</code></td>
<td>Minimum component size</td>
</tr>
<tr class="even">
<td><code>adducts</code>, <code>isotopes</code></td>
<td>Filter features by adduct/istopes annotation</td>
</tr>
<tr class="odd">
<td><code>rtIncrement</code>, <code>mzIncrement</code></td>
<td>Filter homologs by retention/mz increment range</td>
</tr>
</tbody>
</table>
<p>Note that these filters are only applied if the components contain the data the filter works on. For instance, filtering by adducts will <em>not</em> affect components obtained from homologous series.</p>
<p>As before, some typical examples are shown below.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="co"># only keep components with at least 4 features</span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2">componInt &lt;-<span class="st"> </span><span class="kw">filter</span>(componInt, <span class="dt">minSize =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb58-3" data-line-number="3"></a>
<a class="sourceLine" id="cb58-4" data-line-number="4"><span class="co"># remove all features from components are not annotated as an adduct</span></a>
<a class="sourceLine" id="cb58-5" data-line-number="5">componRC &lt;-<span class="st"> </span><span class="kw">filter</span>(componRC, <span class="dt">adducts =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb58-6" data-line-number="6"></a>
<a class="sourceLine" id="cb58-7" data-line-number="7"><span class="co"># only keep protonated and sodium adducts</span></a>
<a class="sourceLine" id="cb58-8" data-line-number="8">componRC &lt;-<span class="st"> </span><span class="kw">filter</span>(componRC, <span class="dt">adducts =</span> <span class="kw">c</span>(<span class="st">&quot;[M+H]+&quot;</span>, <span class="st">&quot;[M+Na]+&quot;</span>))</a>
<a class="sourceLine" id="cb58-9" data-line-number="9"></a>
<a class="sourceLine" id="cb58-10" data-line-number="10"><span class="co"># remove all features not recognized as isotopes</span></a>
<a class="sourceLine" id="cb58-11" data-line-number="11">componRC &lt;-<span class="st"> </span><span class="kw">filter</span>(componRC, <span class="dt">isotopes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb58-12" data-line-number="12"></a>
<a class="sourceLine" id="cb58-13" data-line-number="13"><span class="co"># only keep monoisotopic mass</span></a>
<a class="sourceLine" id="cb58-14" data-line-number="14">componRC &lt;-<span class="st"> </span><span class="kw">filter</span>(componRC, <span class="dt">isotopes =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb58-15" data-line-number="15"></a>
<a class="sourceLine" id="cb58-16" data-line-number="16"><span class="co"># min/max rt/mz increments for homologs</span></a>
<a class="sourceLine" id="cb58-17" data-line-number="17">componNT &lt;-<span class="st"> </span><span class="kw">filter</span>(componNT, <span class="dt">rtIncrement =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb58-18" data-line-number="18">                   <span class="dt">mzIncrement =</span> <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">50</span>))</a></code></pre></div>
<blockquote>
<p><strong><em>NOTE</em></strong> As mentioned before, components are still in a relative young development phase and results should always be verified!</p>
</blockquote>
</div>
<div id="negation" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Negation</h3>
<p>All filters support <em>negation</em>: if enabled all specified filters will be executed in an opposite manner. Negation may not be so commonly used, but allows greater flexibility which is sometimes needed for advanced filtering steps. Furthermore, it is also useful to specifically isolate the data that otherwise would have been removed. Some examples are shown below.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="co"># keep all features/analyses _not_ present from replicate groups &quot;repl1&quot; and &quot;repl2&quot;</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(fGroups, <span class="dt">rGroups =</span> <span class="kw">c</span>(<span class="st">&quot;repl1&quot;</span>, <span class="st">&quot;repl2&quot;</span>), <span class="dt">negate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb59-3" data-line-number="3"></a>
<a class="sourceLine" id="cb59-4" data-line-number="4"><span class="co"># only retain features with a mass defect outside 0.8-0.9</span></a>
<a class="sourceLine" id="cb59-5" data-line-number="5">fGroups &lt;-<span class="st"> </span><span class="kw">filter</span>(<span class="dt">mzDefectRange =</span> <span class="kw">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>), <span class="dt">negate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb59-6" data-line-number="6"></a>
<a class="sourceLine" id="cb59-7" data-line-number="7"><span class="co"># remove candidates with CO2 neutral loss</span></a>
<a class="sourceLine" id="cb59-8" data-line-number="8">formulas &lt;-<span class="st"> </span><span class="kw">filter</span>(formulas, <span class="dt">lossElements =</span> <span class="st">&quot;CO2&quot;</span>, <span class="dt">negate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb59-9" data-line-number="9"></a>
<a class="sourceLine" id="cb59-10" data-line-number="10"><span class="co"># select 15 worst ranked candidates</span></a>
<a class="sourceLine" id="cb59-11" data-line-number="11">compounds &lt;-<span class="st"> </span><span class="kw">filter</span>(compounds, <span class="dt">topMost =</span> <span class="dv">15</span>, <span class="dt">negate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb59-12" data-line-number="12"></a>
<a class="sourceLine" id="cb59-13" data-line-number="13"><span class="co"># only keep components with &lt;5 features</span></a>
<a class="sourceLine" id="cb59-14" data-line-number="14">componInt &lt;-<span class="st"> </span><span class="kw">filter</span>(componInt, <span class="dt">minSize =</span> <span class="dv">5</span>, <span class="dt">negate =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="inspecting-results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="subset.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": false
}
});
});
</script>

</body>

</html>
