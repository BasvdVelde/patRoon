<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>patRoon tutorial • patRoon</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="patRoon tutorial">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">patRoon</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/tutorial.html">Tutorial</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rickhelmus/patRoon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>patRoon tutorial</h1>
                        <h4 class="author">Rick Helmus</h4>
            
            <h4 class="date">2018-03-11</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The intro …</p>
<div id="workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h3>
</div>
</div>
<div id="data-preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h2>
<p>In this tutorial we will use example data provided with patRoon. The provided analyses already have been exported to an open format (<em>.mzML</em>) and are ready to use. For your own data it may be necessary to first perform mass recalibration and data export using vendor software (<code>patRoon</code> supplies several utilities for Bruker data, see the bruker-utils reference documentation).</p>
</div>
<div id="new-project" class="section level2">
<h2 class="hasAnchor">
<a href="#new-project" class="anchor"></a>New project</h2>
<p>To start a new non-target analysis it is highly recommended to create a new directory. We will refer to this directory as the <em>project directory</em>. This directory typically contains: * a <code>R</code> script (or scripts) which will do the actual processing * an (optional) <em>.csv</em> file with analysis information * an automatically generated cache file which is internally used by <code>patRoon</code> to cache (intermediate) results, therefore, preventing repeated execution of lengthy workflow steps that have been performed before.</p>
<p>Once you have created a suitable directory in the location of your choosing, please create the following skeleton <code>R</code> script:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(patRoon)

workPath &lt;-<span class="st"> "~/my_project"</span> <span class="co"># change this to the location of your project directory</span>
## setwd(workPath)

dataDir &lt;-<span class="st"> </span>patRoonData<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/patRoonData/topics/patRoonData">exampleDataPath</a></span>()</code></pre></div>
<p>Next step is to generate information ncessary for the analysis. To do so, we need to specify the names and file locations of the analyses, to which <em>replicate group</em> they belong and which replicate group(s) should be used for blank subtraction. To do so, we can use the <code><a href="../reference/analysis-information.html">generateAnalysisInfo()</a></code> utility function which automatically generates a suitable <code>data.frame</code> for us from given analyses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/analysis-information.html">generateAnalysisInfo</a></span>(dataDir)
<span class="co">#&gt;                                                     path   analysis</span>
<span class="co">#&gt; 1 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-1</span>
<span class="co">#&gt; 2 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-2</span>
<span class="co">#&gt; 3 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-3</span>
<span class="co">#&gt; 4 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-1</span>
<span class="co">#&gt; 5 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-2</span>
<span class="co">#&gt; 6 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-3</span>
<span class="co">#&gt;        group ref</span>
<span class="co">#&gt; 1  solvent-1    </span>
<span class="co">#&gt; 2  solvent-2    </span>
<span class="co">#&gt; 3  solvent-3    </span>
<span class="co">#&gt; 4 standard-1    </span>
<span class="co">#&gt; 5 standard-2    </span>
<span class="co">#&gt; 6 standard-3</span></code></pre></div>
<p>As you can see the generated <code>data.frame</code> consists of four columns:</p>
<ul>
<li>
<em>path</em>: the path of the file directory containing the analysis</li>
<li>
<em>analysis</em>: the name of the analysis. The shoud be the file name <em>without</em> file extension.</li>
<li>
<em>group</em>: to which <em>replicate group</em> the analysis belongs. All analysis which are replicates of each other get the same name.</li>
<li>
<em>ref</em>: which replicate groub should be used for blank subtraction.</li>
</ul>
<p>The latter two columns are especially important for <a href="#data-cleanup">data cleanup</a>.</p>
<p>In our example, the solvents and standards should belong each to a different replicate group (<code>"solvent"</code> and <code>"standards"</code>). The solvents should also be used for blank subtraction. For this we can use the <code>groups</code> and <code>refs</code> arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anaInfo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/analysis-information.html">generateAnalysisInfo</a></span>(dataDir,
                                <span class="dt">groups =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">"solvent"</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">"standard"</span>, <span class="dv">3</span>)),
                                <span class="dt">refs =</span> <span class="st">"solvent"</span>)
anaInfo
<span class="co">#&gt;                                                     path   analysis</span>
<span class="co">#&gt; 1 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-1</span>
<span class="co">#&gt; 2 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-2</span>
<span class="co">#&gt; 3 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-3</span>
<span class="co">#&gt; 4 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-1</span>
<span class="co">#&gt; 5 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-2</span>
<span class="co">#&gt; 6 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-3</span>
<span class="co">#&gt;      group     ref</span>
<span class="co">#&gt; 1  solvent solvent</span>
<span class="co">#&gt; 2  solvent solvent</span>
<span class="co">#&gt; 3  solvent solvent</span>
<span class="co">#&gt; 4 standard solvent</span>
<span class="co">#&gt; 5 standard solvent</span>
<span class="co">#&gt; 6 standard solvent</span></code></pre></div>
<p>Note that we set the reference for the solvents to themself. This will remove any features from the solvents, which is generally fine as we are usually not interested in the blanks anyway.</p>
<p>For larger project it may be preferred to export the <code>data.frame</code> to a <em>.csv</em> file so it can be easily edited, for instance, with Excel. Alternatively, the <code><a href="../reference/GUI-utils.html">newProject()</a></code> function can be used to make this process even easier (briefly discussed <a href="#newProject">here</a>).</p>
</div>
<div id="extract-and-group-features" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-and-group-features" class="anchor"></a>Extract and group features</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fList &lt;-<span class="st"> </span><span class="kw"><a href="../reference/feature-finding.html">findFeatures</a></span>(anaInfo, <span class="st">"openms"</span>, <span class="dt">maxlength =</span> <span class="dv">60</span>, <span class="dt">mzppm =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fList
<span class="co">#&gt; A features object ('featuresOpenMS')</span>
<span class="co">#&gt; Total feature count: 2658</span>
<span class="co">#&gt; Average feature count/analysis: 443</span>
<span class="co">#&gt; Analyses: solvent-1, solvent-2, solvent-3, standard-1, standard-2, standard-3 (6 total)</span>
<span class="co">#&gt; Replicate groups: solvent, standard (2 total)</span>
<span class="co">#&gt; Replicate groups used as ref: solvent (1 total)</span>
<span class="co">#&gt; Object size (indication): 401.1 kB</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fGroups &lt;-<span class="st"> </span><span class="kw"><a href="../reference/feature-grouping.html">groupFeatures</a></span>(fList, <span class="st">"openms"</span>)
fGroups
<span class="co">#&gt; A feature groups object ('featureGroupsOpenMS')</span>
<span class="co">#&gt; Feature groups: M79_R20_1, M79_R20_2, M79_R112_3, M79_R8_4, M85_R112_5, M85_R14_6, ... (644 total)</span>
<span class="co">#&gt; Analyses: solvent-1, solvent-2, solvent-3, standard-1, standard-2, standard-3 (6 total)</span>
<span class="co">#&gt; Replicate groups: solvent, standard (2 total)</span>
<span class="co">#&gt; Replicate groups used as ref: solvent (1 total)</span>
<span class="co">#&gt; Object size (indication): 746.5 kB</span></code></pre></div>
</div>
<div id="data-cleanup" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleanup" class="anchor"></a>Data cleanup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fGroups &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generics.html">filter</a></span>(fGroups, <span class="dt">intensityThreshold =</span> <span class="dv">10000</span>, <span class="dt">intraRGroupAbundance =</span> <span class="dv">1</span>,
                  <span class="dt">minBlankThreshold =</span> <span class="dv">5</span>, <span class="dt">repetitions =</span> <span class="dv">2</span>, <span class="dt">retentionRange =</span> <span class="kw">c</span>(<span class="dv">110</span>, <span class="op">-</span><span class="dv">1</span>))
<span class="co">#&gt; Applying intensity filter... Done! Filtered 411 (63.82%) groups. Remaining: 233.</span>
<span class="co">#&gt; Applying retention filter... Done! Filtered 185 (79.40%) groups. Remaining: 48.</span>
<span class="co">#&gt; filter repetition 1/2</span>
<span class="co">#&gt; Applying replicate filter... Done! Filtered 20 (41.67%) groups. Remaining: 28.</span>
<span class="co">#&gt; Applying blank filter... Done! Filtered 2 (7.14%) groups. Remaining: 26.</span>
<span class="co">#&gt; filter repetition 2/2</span>
<span class="co">#&gt; Applying replicate filter... Done! Filtered 0 (0.00%) groups. Remaining: 26.</span>
<span class="co">#&gt; Applying blank filter... Done! Filtered 0 (0.00%) groups. Remaining: 26.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/generics.html">plotEIC</a></span>(fGroups, <span class="dt">colourBy =</span> <span class="st">"fGroups"</span>, <span class="dt">showFGroupRect =</span> <span class="ot">FALSE</span>, <span class="dt">showPeakArea =</span> <span class="ot">TRUE</span>, <span class="dt">topMost =</span> <span class="dv">1</span>, <span class="dt">showLegend =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="tutorial_files/figure-html/plotEIC-1.png" width="672"></p>
</div>
<div id="ms-peak-lists" class="section level2">
<h2 class="hasAnchor">
<a href="#ms-peak-lists" class="anchor"></a>MS peak lists</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plists &lt;-<span class="st"> </span><span class="kw"><a href="../reference/MSPeakLists-generation.html">generateMSPeakLists</a></span>(fGroups, <span class="st">"mzr"</span>, <span class="dt">avgMzWindow =</span> <span class="fl">0.0005</span>,
                              <span class="dt">avgMinIntensity =</span> <span class="dv">500</span>, <span class="dt">precursorMzWindow =</span> <span class="dv">8</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plists
<span class="co">#&gt; A MSPeakLists object ('MSPeakLists')</span>
<span class="co">#&gt; Total peak count: 14847 (MS: 12770 - MS/MS: 2077)</span>
<span class="co">#&gt; Average peak count/analysis: 4949 (MS: 4257 - MS/MS: 692)</span>
<span class="co">#&gt; Total peak lists: 153 (MS: 78 - MS/MS: 75)</span>
<span class="co">#&gt; Average peak lists/analysis: 51 (MS: 26 - MS/MS: 25)</span>
<span class="co">#&gt; Object size (indication): 461.9 kB</span></code></pre></div>
</div>
<div id="formula-calculation" class="section level2">
<h2 class="hasAnchor">
<a href="#formula-calculation" class="anchor"></a>Formula calculation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">forms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/formula-generation.html">generateFormulas</a></span>(fGroups, <span class="st">"genform"</span>, plists, <span class="dt">maxMzDev =</span> <span class="dv">5</span>,
                          <span class="dt">adduct =</span> <span class="st">"M+H"</span>, <span class="dt">elements =</span> <span class="st">"CHNOPSCl"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">formulas &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generics.html">consensus</a></span>(forms, <span class="dt">fGroups =</span> fGroups)
<span class="co">#&gt; Generating consensus for formula lists (GenForm)... Done!</span>
formulas
<span class="co">#&gt; A formulaConsensus object (formulaConsensus)</span>
<span class="co">#&gt; Algorithm: GenForm</span>
<span class="co">#&gt; Total formula count: 227 (all), 41 (MS) and 186 (MS/MS)</span>
<span class="co">#&gt; Average formulas per feature group: 19.2 (all), 11.6 (MS), 20.9 (MS/MS)</span>
<span class="co">#&gt; Object size (indication): 71.6 kB</span></code></pre></div>
</div>
<div id="compound-identification" class="section level2">
<h2 class="hasAnchor">
<a href="#compound-identification" class="anchor"></a>Compound identification</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">patRoon.path.metFragCL =</span> <span class="st">"~/MetFrag2.4.3-CL.jar"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compounds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compound-generation.html">generateCompounds</a></span>(fGroups, plists, <span class="st">"metfrag"</span>, <span class="dt">topMost =</span> <span class="dv">25</span>,
                               <span class="dt">adduct =</span> <span class="dv">1</span>, <span class="dt">isPositive =</span> <span class="ot">TRUE</span>,
                               <span class="dt">database =</span> <span class="st">"ExtendedPubChem"</span>, <span class="dt">maxCandidatesToStop =</span> <span class="dv">5000</span>,
                               <span class="dt">scoreTypes =</span> <span class="kw">c</span>(<span class="st">"FragmenterScore"</span>, <span class="st">"OfflineMetFusionScore"</span>,
                                              <span class="st">"PubChemNumberPatents"</span>,
                                              <span class="st">"PubChemNumberPubMedReferences"</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compounds
<span class="co">#&gt; A compounds object (compounds)</span>
<span class="co">#&gt; Algorithm: MetFrag</span>
<span class="co">#&gt; Number of feature groups with compounds in this object: 21</span>
<span class="co">#&gt; Number of compounds: 515 (total), 24.5 (mean), 15 - 25 (min - max)</span>
<span class="co">#&gt; Object size (indication): 1.5 MB</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compounds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compounds-class.html">addFormulaScoring</a></span>(compounds, formulas, <span class="dt">updateScore =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="components" class="section level2">
<h2 class="hasAnchor">
<a href="#components" class="anchor"></a>Components</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">components &lt;-<span class="st"> </span><span class="kw"><a href="../reference/component-generation.html">generateComponents</a></span>(fGroups, <span class="st">"camera"</span>, <span class="dt">ionization =</span> <span class="st">"positive"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">components
<span class="co">#&gt; A components object (componentsCamera)</span>
<span class="co">#&gt; Algorithm: CAMERA</span>
<span class="co">#&gt; Components: CMP1, CMP2, CMP3, CMP4, CMP5, CMP6, ... (19 total)</span>
<span class="co">#&gt; Number of feature groups in components: 26 (total), 1.4 (mean), 1 - 3 (min - max)</span>
<span class="co">#&gt; Object size (indication): 505.4 kB</span></code></pre></div>
</div>
<div id="reporting" class="section level2">
<h2 class="hasAnchor">
<a href="#reporting" class="anchor"></a>Reporting</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/reporting.html">reportCSV</a></span>(fGroups, <span class="dt">formConsensus =</span> formulas, <span class="dt">compounds =</span> compounds, <span class="dt">components =</span> components)
<span class="kw"><a href="../reference/reporting.html">reportPDF</a></span>(fGroups, <span class="dt">formConsensus =</span> formulas, <span class="dt">compounds =</span> compounds, <span class="dt">components =</span> components,
          <span class="dt">MSPeakLists =</span> plists)
<span class="kw"><a href="../reference/reporting.html">reportMD</a></span>(fGroups, <span class="dt">formConsensus =</span> formulas, <span class="dt">compounds =</span> compounds, <span class="dt">components =</span> components,
         <span class="dt">MSPeakLists =</span> plists)</code></pre></div>
</div>
<div id="final-script" class="section level2">
<h2 class="hasAnchor">
<a href="#final-script" class="anchor"></a>Final script</h2>
</div>
<div id="other-topics" class="section level2">
<h2 class="hasAnchor">
<a href="#other-topics" class="anchor"></a>Other topics</h2>
<div id="newProject" class="section level3">
<h3 class="hasAnchor">
<a href="#newProject" class="anchor"></a>Create new projects with <code><a href="../reference/GUI-utils.html">newProject()</a></code>
</h3>
</div>
<div id="suspect-screening" class="section level3">
<h3 class="hasAnchor">
<a href="#suspect-screening" class="anchor"></a>Suspect screening</h3>
</div>
<div id="import-and-exporting-feature-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#import-and-exporting-feature-groups" class="anchor"></a>Import and exporting feature groups</h3>
</div>
<div id="caching" class="section level3">
<h3 class="hasAnchor">
<a href="#caching" class="anchor"></a>caching</h3>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#data-preparation">Data preparation</a></li>
      <li><a href="#new-project">New project</a></li>
      <li><a href="#extract-and-group-features">Extract and group features</a></li>
      <li><a href="#data-cleanup">Data cleanup</a></li>
      <li><a href="#ms-peak-lists">MS peak lists</a></li>
      <li><a href="#formula-calculation">Formula calculation</a></li>
      <li><a href="#compound-identification">Compound identification</a></li>
      <li><a href="#components">Components</a></li>
      <li><a href="#reporting">Reporting</a></li>
      <li><a href="#final-script">Final script</a></li>
      <li><a href="#other-topics">Other topics</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
