<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>patRoon tutorial • patRoon</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="patRoon tutorial">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">patRoon</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/tutorial.html">Tutorial</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rickhelmus/patRoon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>patRoon tutorial</h1>
                        <h4 class="author">Rick Helmus</h4>
            
            <h4 class="date">2018-03-15</h4>
          </div>

    
    
<div class="contents">
<style>
pre, code {
    white-space: pre !important;
    overflow-x: auto !important;
}
</style>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The intro …</p>
<div id="workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h3>
</div>
</div>
<div id="data-preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h2>
<p>In this tutorial we will use example data provided within the [patRoonData] package. Please make sure this package is installed (see the [readme] for brief installation instructions). The example dataset contains LC-MS data for a standard mixture with known composition (‘standard-X’) and a blank solvent (‘solvent-X’), both in triplicate. While this may not seem like the most exciting data, it does allow to demonstrate the most important functionalities of <code>patRoon</code>.</p>
<p>The provided analyses already have been exported to an open format (<em>.mzML</em>) and are ready to use. For your own data it may be necessary to first perform mass recalibration and data export using external tools such as [proteowizard] or vendor software (<code>patRoon</code> supplies several utilities for Bruker data, see the bruker-utils reference documentation) to <em>mzML</em> or <em>mzXML</em> files.</p>
</div>
<div id="new-project" class="section level2">
<h2 class="hasAnchor">
<a href="#new-project" class="anchor"></a>New project</h2>
<p>To start a new non-target analysis it is highly recommended to create a new directory. We will refer to this directory as the <em>project directory</em>. This directory typically contains:</p>
<ul>
<li>an <code>R</code> script (or scripts) which will do the non-target data processing</li>
<li>an (optional) <em>.csv</em> file with analysis information</li>
<li>an automatically generated cache file which is internally used by <code>patRoon</code> to cache (intermediate) results, therefore, preventing repeated execution of lengthy workflow steps that have been performed before.</li>
</ul>
<p>Once you have created a suitable directory in the location of your choosing, please create the following skeleton <code>R</code> script:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(patRoon)

workPath &lt;-<span class="st"> "~/my_project"</span> <span class="co"># change this to the location of your project directory</span>
## setwd(workPath)

dataDir &lt;-<span class="st"> </span>patRoonData<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/patRoonData/topics/patRoonData">exampleDataPath</a></span>() <span class="co"># path to example data files</span></code></pre></div>
<p>The next step is to generate information ncessary for the analysis. To do so, we need to specify the names and file locations of the analyses, to which <em>replicate group</em> they belong and which replicate group(s) should be used for blank subtraction. To do so, we can use the <code><a href="../reference/analysis-information.html">generateAnalysisInfo()</a></code> utility function which automatically generates a suitable <code>data.frame</code> for us from given analyses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/analysis-information.html">generateAnalysisInfo</a></span>(dataDir)
<span class="co">#&gt;                                                     path   analysis      group ref</span>
<span class="co">#&gt; 1 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-1  solvent-1    </span>
<span class="co">#&gt; 2 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-2  solvent-2    </span>
<span class="co">#&gt; 3 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-3  solvent-3    </span>
<span class="co">#&gt; 4 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-1 standard-1    </span>
<span class="co">#&gt; 5 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-2 standard-2    </span>
<span class="co">#&gt; 6 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-3 standard-3</span></code></pre></div>
<p>As you can see the generated <code>data.frame</code> consists of four columns:</p>
<ul>
<li>
<em>path</em>: the path of the file directory containing the analysis</li>
<li>
<em>analysis</em>: the name of the analysis. The shoud be the file name <em>without</em> file extension.</li>
<li>
<em>group</em>: to which <em>replicate group</em> the analysis belongs. All analysis which are replicates of each other get the same name.</li>
<li>
<em>ref</em>: which replicate group should be used for blank subtraction.</li>
</ul>
<p>The latter two columns are especially important for <a href="#data-cleanup">data cleanup</a>.</p>
<p>In our example, the solvents and standards should belong each to a different replicate group (<code>"solvent"</code> and <code>"standard"</code>). The solvents should be used for blank subtraction. For this we can use the <code>groups</code> and <code>refs</code> arguments of <code><a href="../reference/analysis-information.html">generateAnalysisInfo()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anaInfo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/analysis-information.html">generateAnalysisInfo</a></span>(dataDir,
                                <span class="dt">groups =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">"solvent"</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">"standard"</span>, <span class="dv">3</span>)),
                                <span class="dt">refs =</span> <span class="st">"solvent"</span>)
anaInfo
<span class="co">#&gt;                                                     path   analysis    group     ref</span>
<span class="co">#&gt; 1 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-1  solvent solvent</span>
<span class="co">#&gt; 2 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-2  solvent solvent</span>
<span class="co">#&gt; 3 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata  solvent-3  solvent solvent</span>
<span class="co">#&gt; 4 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-1 standard solvent</span>
<span class="co">#&gt; 5 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-2 standard solvent</span>
<span class="co">#&gt; 6 C:/Program Files/R/R-3.4.3/library/patRoonData/extdata standard-3 standard solvent</span></code></pre></div>
<p>Note that we set the reference for the solvents to themself. This will remove any features from the solvents, which is generally fine as we are usually not interested in the blanks anyway.</p>
<p>Depending on your preference, it may be preferred to export the <code>data.frame</code> to a <em>.csv</em> file for larger project so it can be easily edited, for instance, with graphical tools such as Excel. Alternatively, the <code><a href="../reference/GUI-utils.html">newProject()</a></code> function can be used to make this process even easier (briefly discussed <a href="#newProject">here</a>).</p>
</div>
<div id="extract-and-group-features" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-and-group-features" class="anchor"></a>Extract and group features</h2>
<p>The first step of a LC-MS non-target analysis workflow is typically the extraction of so called ‘features’. While sometimes slightly different definitions are used, a feature can be seen as a single peak within an extracted ion chromatogram. For a complex sample it is not uncommon that hundreds to thousands of features can extracted. Because these large numbers this process is typically automatized nowadays.</p>
<p>To obtain all the features within your dataset the <code>findFeatures</code> function is used. This function requires that the analysis information (<code>anaInfo</code> variable created earlier) and the desired algorithm that should be used. On top of that there are many more options that can significantly influence the feature finding process, hence, it is important to evaulate results afterwards.</p>
<p>In this tutorial we will use the [OpenMS] software to find features:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fList &lt;-<span class="st"> </span><span class="kw"><a href="../reference/feature-finding.html">findFeatures</a></span>(anaInfo, <span class="st">"openms"</span>, <span class="dt">mzppm =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fList
<span class="co">#&gt; A features object ('featuresOpenMS')</span>
<span class="co">#&gt; Total feature count: 2662</span>
<span class="co">#&gt; Average feature count/analysis: 444</span>
<span class="co">#&gt; Analyses: solvent-1, solvent-2, solvent-3, standard-1, standard-2, standard-3 (6 total)</span>
<span class="co">#&gt; Replicate groups: solvent, standard (2 total)</span>
<span class="co">#&gt; Replicate groups used as ref: solvent (1 total)</span>
<span class="co">#&gt; Object size (indication): 401.6 kB</span></code></pre></div>
<p>After some processing time (especially for larger datasets), the next step is to <em>group features</em>. During this step, features from different analysis are grouped by alignment of their retention times and <em>m/z</em> data. This alignment is necessary because it is common that instrumental error will result in (slight) variations for these data between analyses.</p>
<p>To group features the <code><a href="../reference/feature-grouping.html">groupFeatures()</a></code> function is used, which has similar argument requirements as <code>findFeatures</code> and many more options to tune the process.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fGroups &lt;-<span class="st"> </span><span class="kw"><a href="../reference/feature-grouping.html">groupFeatures</a></span>(fList, <span class="st">"openms"</span>)
fGroups
<span class="co">#&gt; A feature groups object ('featureGroupsOpenMS')</span>
<span class="co">#&gt; Feature groups: M79_R20_1, M79_R20_2, M79_R112_3, M79_R8_4, M85_R113_5, M85_R14_6, ... (639 total)</span>
<span class="co">#&gt; Analyses: solvent-1, solvent-2, solvent-3, standard-1, standard-2, standard-3 (6 total)</span>
<span class="co">#&gt; Replicate groups: solvent, standard (2 total)</span>
<span class="co">#&gt; Replicate groups used as ref: solvent (1 total)</span>
<span class="co">#&gt; Object size (indication): 744.5 kB</span></code></pre></div>
<p>The <code><a href="../reference/featureGroups-class.html">groupTable()</a></code> function can be used to have a look at generated feature groups and their intensities (<em>i.e.</em> peak heights) across all analyses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw"><a href="../reference/featureGroups-class.html">groupTable</a></span>(fGroups))
<span class="co">#&gt;         group        ret       mz solvent-1 solvent-2 solvent-3 standard-1 standard-2 standard-3</span>
<span class="co">#&gt; 1:  M79_R20_1  19.637963 78.99679      7828      7092      7320       5368       7456       6812</span>
<span class="co">#&gt; 2:  M79_R20_2  19.804059 79.02095         0         0         0      10540       7040       2036</span>
<span class="co">#&gt; 3: M79_R112_3 112.041979 79.02098         0         0         0      24352       7008       4240</span>
<span class="co">#&gt; 4:   M79_R8_4   8.143214 79.02099         0         0         0      93420      88860          0</span>
<span class="co">#&gt; 5: M85_R113_5 112.631040 84.95948      8872      8780     10816       9596       8728       8732</span>
<span class="co">#&gt; 6:  M85_R14_6  14.141316 84.95951    223372    207404    201416     252608     251744     235596</span></code></pre></div>
</div>
<div id="data-cleanup" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleanup" class="anchor"></a>Data cleanup</h2>
<p>The next step is to perform some basic rule based filtering with the <code><a href="../reference/generics.html">filter()</a></code> function. As its name suggests this function has several way to filter data. It is a so called <em>generic</em> function and <em>methods</em> exists for various data types, such as the feature groups object (<code>fGroups</code>) that was made in the previous section.</p>
<p>In this tutorial we will filter grouped features (or ‘feature groups’) based on a minimal intensity, minimal abundance within replicates and absence within blanks. Finally, we will also remove any feature groups eluting before roughly the dead volume of the system:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fGroups &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generics.html">filter</a></span>(fGroups, <span class="dt">intensityThreshold =</span> <span class="dv">10000</span>, <span class="dt">intraRGroupAbundance =</span> <span class="dv">1</span>,
                  <span class="dt">minBlankThreshold =</span> <span class="dv">5</span>, <span class="dt">repetitions =</span> <span class="dv">2</span>, <span class="dt">retentionRange =</span> <span class="kw">c</span>(<span class="dv">110</span>, <span class="op">-</span><span class="dv">1</span>))
<span class="co">#&gt; Applying intensity filter... Done! Filtered 406 (63.54%) groups. Remaining: 233.</span>
<span class="co">#&gt; Applying retention filter... Done! Filtered 185 (79.40%) groups. Remaining: 48.</span>
<span class="co">#&gt; filter repetition 1/2</span>
<span class="co">#&gt; Applying replicate filter... Done! Filtered 17 (35.42%) groups. Remaining: 31.</span>
<span class="co">#&gt; Applying blank filter... Done! Filtered 2 (6.45%) groups. Remaining: 29.</span>
<span class="co">#&gt; filter repetition 2/2</span>
<span class="co">#&gt; Applying replicate filter... Done! Filtered 0 (0.00%) groups. Remaining: 29.</span>
<span class="co">#&gt; Applying blank filter... Done! Filtered 0 (0.00%) groups. Remaining: 29.</span></code></pre></div>
<p>As can been from above command this will remove quite a large part our data. However, in our experience using the right settings is a very effective way to separate interesting data from the rest. Some hints on this process:</p>
<ul>
<li>The intensity filter is an effective way to remove not oly ‘noisy’ data, but can also be used to remove any low intensity peaks which are very likely to miss any MS/MS data (assuming you are interested in this and data has been recorded with it).</li>
<li>The <code>intraRGroupAbundance</code> argument specifies a fraction to which a feature group should be minimally present within all replicates. This is a <em>very</em> effective filter in removing any outliers or features which don’t actually represent a well defined chromatographic peak, but perhaps are just part of another peak or simply noise.</li>
<li>The <code>minBlankThreshold</code> argument is used for blank subtraction. In the above example, any features with an intensity less than five times compared to the average intensity in blanks will be removed.</li>
<li>The <code>repetitions</code> argument is used to repeat some of the filter steps to make sure that all the data is really filtered out. A value of two is usually sufficient.</li>
</ul>
<p>Finally, we can have a quick look at our data by plotting some nice extracted ion chromatograms (EICs) for all remaining feature groups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/generics.html">plotEIC</a></span>(fGroups, <span class="dt">colourBy =</span> <span class="st">"fGroups"</span>, <span class="dt">showFGroupRect =</span> <span class="ot">FALSE</span>, <span class="dt">showPeakArea =</span> <span class="ot">TRUE</span>,
        <span class="dt">topMost =</span> <span class="dv">1</span>, <span class="dt">showLegend =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="tutorial_files/figure-html/plotEIC-1.png" width="672"></p>
<p>The next logical step in a non-target workflow is most likely to perform further prioritization of data. However, in this tutorial we are just dealing with a relative simple standard mixture, se we will move to the identification part.</p>
</div>
<div id="ms-peak-lists" class="section level2">
<h2 class="hasAnchor">
<a href="#ms-peak-lists" class="anchor"></a>MS peak lists</h2>
<p>Having obtained a good dataset with features of interest, we can start moving to figuring out what these may be. Before performing any identification steps, however, the first step is to extract all relevant MS data. This data was obtained with data-dependent MS/MS mode, so in the ideal case we obtain al MS and MS/MS spectra for each feature group.</p>
<p>The <code><a href="../reference/MSPeakLists-generation.html">generateMSPeakLists()</a></code> will perform this action for us and will generate so called <em>MS peaklists</em> in the process. These peaklists are basicially the relevant MS and MS/MS spectra in tabular form. The command below will use the <em>mzR</em> algorithm to do so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plists &lt;-<span class="st"> </span><span class="kw"><a href="../reference/MSPeakLists-generation.html">generateMSPeakLists</a></span>(fGroups, <span class="st">"mzr"</span>, <span class="dt">avgMzWindow =</span> <span class="fl">0.0005</span>,
                              <span class="dt">avgMinIntensity =</span> <span class="dv">500</span>, <span class="dt">precursorMzWindow =</span> <span class="dv">8</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plists
<span class="co">#&gt; A MSPeakLists object ('MSPeakLists')</span>
<span class="co">#&gt; Total peak count: 19715 (MS: 17142 - MS/MS: 2573)</span>
<span class="co">#&gt; Average peak count/analysis: 6572 (MS: 5714 - MS/MS: 858)</span>
<span class="co">#&gt; Total peak lists: 171 (MS: 87 - MS/MS: 84)</span>
<span class="co">#&gt; Average peak lists/analysis: 57 (MS: 29 - MS/MS: 28)</span>
<span class="co">#&gt; Object size (indication): 565.8 kB</span></code></pre></div>
</div>
<div id="formula-calculation" class="section level2">
<h2 class="hasAnchor">
<a href="#formula-calculation" class="anchor"></a>Formula calculation</h2>
<p>Using the data from the MS peaklists generated during the previous step we can generate a list of formula candidates for each feature group based on measured <em>m/z</em> values, isotopic patterns and presence of MS/MS fragments. In this tutorial we will use this data as an extra hint to score canddiate chemical structures generated during the next step. The command below will use [GenForm] to perform this step:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">forms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/formula-generation.html">generateFormulas</a></span>(fGroups, <span class="st">"genform"</span>, plists, <span class="dt">maxMzDev =</span> <span class="dv">5</span>,
                          <span class="dt">adduct =</span> <span class="st">"M+H"</span>, <span class="dt">elements =</span> <span class="st">"CHNOPSCl"</span>)</code></pre></div>
<p>Note that we limited to only to the the elements C, H, N, O, O, S and Cl. It is highly recommended to limit the elements (by default it is just C, H, N, O and P) as this can signfificantly reduce porcessing time and improper numbers. In this tutorial we already knew which compounds to expect so the choice was easy, but often a good guess can be made in advance.</p>
<p>The <code><a href="../reference/formula-generation.html">generateFormulas()</a></code> function returns a list of formulas of every feature in all analyses. The <code><a href="../reference/generics.html">consensus()</a></code> function is used subsequently to generate a final table of formula candidates for each feature group. During this process, any formulas for a particular feature group which were detected in only a fraction of the analyses (by default &lt;75%, controlled by the <code>formAnaThreshold</code> argument) are considered as outliers and removed. In addition, this function will also set a limit to only keep a number of top candidates (ten by default, controlled by the <code>maxFormulas</code> and <code>maxFragFormulas</code> arguments). In this tutorial we will just stick with defaults:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">formulas &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generics.html">consensus</a></span>(forms, <span class="dt">fGroups =</span> fGroups)
<span class="co">#&gt; Generating consensus for formula lists (GenForm)... Done!</span>
formulas
<span class="co">#&gt; A formulaConsensus object (formulaConsensus)</span>
<span class="co">#&gt; Algorithm: GenForm</span>
<span class="co">#&gt; Total formula count: 246 (all), 41 (MS) and 205 (MS/MS)</span>
<span class="co">#&gt; Average formulas per feature group: 18.3 (all), 11.6 (MS), 19.6 (MS/MS)</span>
<span class="co">#&gt; Object size (indication): 75.8 kB</span></code></pre></div>
</div>
<div id="compound-identification" class="section level2">
<h2 class="hasAnchor">
<a href="#compound-identification" class="anchor"></a>Compound identification</h2>
<p>Now it is time to actually see what compounds we may be dealing with. In this tutorial we will use [MetFrag] to come up with a list of possible candidates structures for each feature group. Before we can start you have to download the [MetFrag CLI jar file][MetFragCLI] and specify its file location:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">patRoon.path.metFragCL =</span> <span class="st">"~/MetFrag2.4.3-CL.jar"</span>) <span class="co"># change to the full path of the MetFrag CLI jar file</span></code></pre></div>
<p>Then <code><a href="../reference/compound-generation.html">generateCompounds()</a></code> is used to execute MetFrag and generate the <code>compounds</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compounds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compound-generation.html">generateCompounds</a></span>(fGroups, plists, <span class="st">"metfrag"</span>, <span class="dt">topMost =</span> <span class="dv">25</span>,
                               <span class="dt">adduct =</span> <span class="dv">1</span>, <span class="dt">isPositive =</span> <span class="ot">TRUE</span>,
                               <span class="dt">database =</span> <span class="st">"ExtendedPubChem"</span>, <span class="dt">maxCandidatesToStop =</span> <span class="dv">5000</span>,
                               <span class="dt">scoreTypes =</span> <span class="kw">c</span>(<span class="st">"FragmenterScore"</span>, <span class="st">"OfflineMetFusionScore"</span>,
                                              <span class="st">"PubChemNumberPatents"</span>,
                                              <span class="st">"PubChemNumberPubMedReferences"</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compounds
<span class="co">#&gt; A compounds object (compounds)</span>
<span class="co">#&gt; Algorithm: MetFrag</span>
<span class="co">#&gt; Number of feature groups with compounds in this object: 23</span>
<span class="co">#&gt; Number of compounds: 559 (total), 24.3 (mean), 9 - 25 (min - max)</span>
<span class="co">#&gt; Object size (indication): 1.7 MB</span>
<span class="kw"><a href="../reference/generics.html">plotSpec</a></span>(compounds, <span class="dv">1</span>, <span class="st">"M120_R328_91"</span>, plists)</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-7-1.png" width="384"></p>
<p>While <code><a href="../reference/compound-generation.html">generateCompounds()</a></code> is running a list of candidate compound structures will be downloaded for every feature group (in this case from PubChem) and ranked according to various scoring parameters.</p>
<p>As with previous described workfow functions, there are many different arguments that can specified to modify the behaviour when generating compounds. In brief, here we limit the number to the top 25 candidates (this will save a lot of processing time), specify that we are primarily interested in protonated ions and use the extended PubChem database so that we can score on number of patents and PubMed references along with scoring for similarity to in-silico generated MS/MS spectra (<code>FragmenterScore</code>) and MassBank derived mass spectra (<code>OfflineMetFusionScore</code>).</p>
<p>As a side note: this is often one of the most time consuming steps during the workflow. For this reason, and in order to not ‘abuse’ the server used by MetFrag, you should always take care to prioritie your data before running this function.</p>
<p>In the previous step we generated candidate formulas for all feature groups. These can be used to add yet another scoring parameter so we can assess if the formula part of a candidate structure makes sense:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compounds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compounds-class.html">addFormulaScoring</a></span>(compounds, formulas, <span class="dt">updateScore =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="components" class="section level2">
<h2 class="hasAnchor">
<a href="#components" class="anchor"></a>Components</h2>
<p>So far we mainly dealt with feature groups as if they are separate chemical compounds. However, formation of multiple ionization adducts (<em>e.g.</em> sodium and potassium) and the presence of isotopologues yield multiple <em>m/z</em> values for the same compound. As a result, multiple feature groups will be present describing the same chemical compound, each describing the same retention pattern. To reduce this complexity it is useful to generate so called <em>components</em> which are basically groups of feature groups which are likely to be the same compound. Another advantage is this grouping process is that extra chemical information of a compound is revealed which may help compound identification.</p>
<p>Generating components is performed with the <code><a href="../reference/component-generation.html">generateComponents()</a></code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">components &lt;-<span class="st"> </span><span class="kw"><a href="../reference/component-generation.html">generateComponents</a></span>(fGroups, <span class="st">"camera"</span>, <span class="dt">ionization =</span> <span class="st">"positive"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">components
<span class="co">#&gt; A components object (componentsCamera)</span>
<span class="co">#&gt; Algorithm: CAMERA</span>
<span class="co">#&gt; Components: CMP1, CMP2, CMP3, CMP4, CMP5, CMP6, ... (20 total)</span>
<span class="co">#&gt; Number of feature groups in components: 29 (total), 1.4 (mean), 1 - 3 (min - max)</span>
<span class="co">#&gt; Object size (indication): 512.9 kB</span>
<span class="kw"><a href="../reference/generics.html">plotSpec</a></span>(components, <span class="st">"CMP17"</span>)</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/generics.html">plotEIC</a></span>(components, <span class="st">"CMP17"</span>, fGroups)</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-9-2.png" width="480"></p>
</div>
<div id="reporting" class="section level2">
<h2 class="hasAnchor">
<a href="#reporting" class="anchor"></a>Reporting</h2>
<p>The last step of the workflow is typically reporting data: during this step all the collected data is transformed to graphical plots (<code><a href="../reference/reporting.html">reportPDF()</a></code> and <code><a href="../reference/reporting.html">reportMD()</a></code>) or tabular csv data (<code><a href="../reference/reporting.html">reportCSV()</a></code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/reporting.html">reportCSV</a></span>(fGroups, <span class="dt">formConsensus =</span> formulas, <span class="dt">compounds =</span> compounds, <span class="dt">components =</span> components)
<span class="kw"><a href="../reference/reporting.html">reportPDF</a></span>(fGroups, <span class="dt">formConsensus =</span> formulas, <span class="dt">compounds =</span> compounds, <span class="dt">components =</span> components,
          <span class="dt">MSPeakLists =</span> plists)
<span class="kw"><a href="../reference/reporting.html">reportMD</a></span>(fGroups, <span class="dt">formConsensus =</span> formulas, <span class="dt">compounds =</span> compounds, <span class="dt">components =</span> components,
         <span class="dt">MSPeakLists =</span> plists)</code></pre></div>
<p>The output of <code><a href="../reference/reporting.html">reportMD()</a></code> can be viewed <a href="../examples/report.html">here</a>.</p>
<p>Note that these functions can be called at any time during the workflow. This may be especially useful if you want evaluate results during optimization or exploring the various algorithms available.</p>
</div>
<div id="final-script" class="section level2">
<h2 class="hasAnchor">
<a href="#final-script" class="anchor"></a>Final script</h2>
</div>
<div id="other-topics" class="section level2">
<h2 class="hasAnchor">
<a href="#other-topics" class="anchor"></a>Other topics</h2>
<div id="newProject" class="section level3">
<h3 class="hasAnchor">
<a href="#newProject" class="anchor"></a>Create new projects with <code><a href="../reference/GUI-utils.html">newProject()</a></code>
</h3>
<p>In this tutorial we started with creating a project directory with a template script and using the <code><a href="../reference/analysis-information.html">generateAnalysisInfo()</a></code> to (semi-)automatically generate analysis information required for subsequent workflow steps. If you are using (a recent version of) R Studio a quicker and potentially user friendlier alternative is to use the <code><a href="../reference/GUI-utils.html">newProject()</a></code> function. This function will present you with a ‘wizard’ like graphical screen guiding you to choose a project directory, select all analyses and select all common workflow steps that should be executed. When finished the input will then be used to generate a template processing script.</p>
</div>
<div id="suspect-screening" class="section level3">
<h3 class="hasAnchor">
<a href="#suspect-screening" class="anchor"></a>Suspect screening</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/target-screening.html">screenTargets</a></span>(fGroups, patRoonData<span class="op">::</span>targets)
<span class="co">#&gt; Found 23/23 targets (100.00%)</span>
<span class="kw">head</span>(scr)
<span class="co">#&gt;                      name  rt       mz         group   exp_rt   exp_mz        d_rt          d_mz solvent-1 solvent-2 solvent-3 standard-1 standard-2 standard-3</span>
<span class="co">#&gt; 1:       1H-benzotriazole 328 120.0556  M120_R328_91 327.9651 120.0555 -0.03486930 -1.330000e-04         0         0         0      56936      61668      60600</span>
<span class="co">#&gt; 2: 2-methylamino-pyridine 113 109.0760  M109_R116_61 115.7685 109.0759  2.76848297 -8.100000e-05         0         0         0      15980      15508      13796</span>
<span class="co">#&gt; 3:             2-quinolol 369 146.0600 M146_R369_178 368.8301 146.0600 -0.16986902 -6.466667e-05         0         0         0      64060      60760      63436</span>
<span class="co">#&gt; 4:             4-quinolol 277 146.0600 M146_R277_177 277.1632 146.0600  0.16320371 -7.233333e-05         0         0         0      66880      71080      68756</span>
<span class="co">#&gt; 5:             6-quinolol 214 146.0600 M146_R214_176 214.4695 146.0600  0.46945354 -8.000000e-05         0         0         0      16940      16340      17864</span>
<span class="co">#&gt; 6:             8-quinolol 185 146.0600 M146_R185_175 184.9442 146.0599 -0.05576015 -1.716667e-04         0         0         0      24516      25100      24172</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fGroupsScreening &lt;-<span class="st"> </span><span class="kw"><a href="../reference/target-screening.html">groupFeaturesScreening</a></span>(fGroups, scr)
<span class="co">#&gt; Converting screening results to feature groups... Done!</span>
<span class="kw">head</span>(<span class="kw"><a href="../reference/featureGroups-class.html">groupTable</a></span>(fGroupsScreening))
<span class="co">#&gt;                     group      ret       mz solvent-1 solvent-2 solvent-3 standard-1 standard-2 standard-3</span>
<span class="co">#&gt; 1:       1H-benzotriazole 327.9651 120.0555         0         0         0      56936      61668      60600</span>
<span class="co">#&gt; 2: 2-methylamino-pyridine 115.7685 109.0759         0         0         0      15980      15508      13796</span>
<span class="co">#&gt; 3:             2-quinolol 368.8301 146.0600         0         0         0      64060      60760      63436</span>
<span class="co">#&gt; 4:             4-quinolol 277.1632 146.0600         0         0         0      66880      71080      68756</span>
<span class="co">#&gt; 5:             6-quinolol 214.4695 146.0600         0         0         0      16940      16340      17864</span>
<span class="co">#&gt; 6:             8-quinolol 184.9442 146.0599         0         0         0      24516      25100      24172</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/generics.html">plotEIC</a></span>(fGroupsScreening, <span class="dt">colourBy =</span> <span class="st">"fGroups"</span>, <span class="dt">showFGroupRect =</span> <span class="ot">FALSE</span>, <span class="dt">showPeakArea =</span> <span class="ot">TRUE</span>,
        <span class="dt">topMost =</span> <span class="dv">1</span>, <span class="dt">showLegend =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># perform 'regular' workflow steps as shown before (MS peak lists, formulas, compounds, ...)</span></code></pre></div>
</div>
<div id="import-and-exporting-feature-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#import-and-exporting-feature-groups" class="anchor"></a>Import and exporting feature groups</h3>
</div>
<div id="caching" class="section level3">
<h3 class="hasAnchor">
<a href="#caching" class="anchor"></a>caching</h3>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#data-preparation">Data preparation</a></li>
      <li><a href="#new-project">New project</a></li>
      <li><a href="#extract-and-group-features">Extract and group features</a></li>
      <li><a href="#data-cleanup">Data cleanup</a></li>
      <li><a href="#ms-peak-lists">MS peak lists</a></li>
      <li><a href="#formula-calculation">Formula calculation</a></li>
      <li><a href="#compound-identification">Compound identification</a></li>
      <li><a href="#components">Components</a></li>
      <li><a href="#reporting">Reporting</a></li>
      <li><a href="#final-script">Final script</a></li>
      <li><a href="#other-topics">Other topics</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
